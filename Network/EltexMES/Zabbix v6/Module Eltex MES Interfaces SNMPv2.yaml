zabbix_export:
  version: '6.0'
  date: '2024-04-23T13:16:38Z'
  groups:
    -
      uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    -
      uuid: 263badc3b7f8422282f2511a6f3cf7bf
      template: 'Module Eltex MES Interfaces SNMPv2'
      name: 'Module Eltex MES Interfaces SNMPv2'
      description: |
        https://github.com/AndAndr
        Автообнаружение интерфейсов для коммутаторов Eltex серии MES.
      groups:
        -
          name: Templates/Modules
      discovery_rules:
        -
          uuid: e8ba56029e284fa581082162748dc253
          name: 'Copper network interfaces discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFOPERSTATUS},1.3.6.1.2.1.2.2.1.8,{#IFADMINSTATUS},1.3.6.1.2.1.2.2.1.7,{#IFALIAS},1.3.6.1.2.1.31.1.1.1.18,{#IFNAME},1.3.6.1.2.1.31.1.1.1.1,{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#MEDIATYPE},1.3.6.1.4.1.89.53.3.1.3]'
          key: copper.net.if.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#IFOPERSTATUS}'
                value: '{$NET.IF.IFOPERSTATUS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#MEDIATYPE}'
                value: '^[2-3]$'
                operator: NOT_MATCHES_REGEX
                formulaid: I
              -
                macro: '{#IFADMINSTATUS}'
                value: '{$NET.IF.IFADMINSTATUS.MATCHES}'
                formulaid: A
              -
                macro: '{#IFADMINSTATUS}'
                value: '{$NET.IF.IFADMINSTATUS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
              -
                macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.MATCHES}'
                formulaid: E
              -
                macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: F
              -
                macro: '{#IFALIAS}'
                value: '{$NET.IF.IFALIAS.MATCHES}'
                formulaid: C
              -
                macro: '{#IFALIAS}'
                value: '{$NET.IF.IFALIAS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
              -
                macro: '{#IFOPERSTATUS}'
                value: '{$NET.IF.IFOPERSTATUS.MATCHES}'
                formulaid: H
              -
                macro: '{#MEDIATYPE}'
                value: '^.*$'
                formulaid: J
          lifetime: 1h
          description: 'Discovering copper interfaces.'
          item_prototypes:
            -
              uuid: 4f3175f24a5e43aebefa645cc34aab38
              name: 'Interface {#IFNAME}({#IFALIAS}): Inbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.13.{#SNMPINDEX}'
              key: 'net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: 60d
              description: |
                MIB: IF-MIB
                The number of inbound packets which were chosen to be discarded
                even though no errors had been detected to prevent their being deliverable to a higher-layer protocol.
                One possible reason for discarding such a packet could be to free up buffer space.
                Discontinuities in the value of this counter can occur at re-initialization of the management system,
                and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: description
                  value: '{#IFALIAS}'
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: 765f04d00d9240818d19ce8ae2cd5f62
              name: 'Interface {#IFNAME}({#IFALIAS}): Inbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: 60d
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of inbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of inbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: description
                  value: '{#IFALIAS}'
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: ee6fc84fac454fb4a84a3b863aff0c43
              name: 'Interface {#IFNAME}({#IFALIAS}): Bits received'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.6.{#SNMPINDEX}'
              key: 'net.if.in[ifHCInOctets.{#SNMPINDEX}]'
              history: 14d
              trends: 60d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets received on the interface, including framing characters. This object is a 64-bit version of ifInOctets. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: description
                  value: '{#IFALIAS}'
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: e09ee84991e64f17b38bdca1fc59e171
              name: 'Interface {#IFNAME}({#IFALIAS}): Outbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.19.{#SNMPINDEX}'
              key: 'net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: 60d
              description: |
                MIB: IF-MIB
                The number of outbound packets which were chosen to be discarded
                even though no errors had been detected to prevent their being deliverable to a higher-layer protocol.
                One possible reason for discarding such a packet could be to free up buffer space.
                Discontinuities in the value of this counter can occur at re-initialization of the management system,
                and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: description
                  value: '{#IFALIAS}'
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: 72adacb17d7a4dc9a9a3c06b5535508c
              name: 'Interface {#IFNAME}({#IFALIAS}): Outbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: 60d
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of outbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of outbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: description
                  value: '{#IFALIAS}'
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: f44afd4949b74441a04b61734c856a08
              name: 'Interface {#IFNAME}({#IFALIAS}): Bits sent'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.10.{#SNMPINDEX}'
              key: 'net.if.out[ifHCOutOctets.{#SNMPINDEX}]'
              history: 14d
              trends: 60d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets transmitted out of the interface, including framing characters. This object is a 64-bit version of ifOutOctets.Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: description
                  value: '{#IFALIAS}'
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: f2332eb786a84e8289ace5a91a7d20ec
              name: 'Interface {#IFNAME}({#IFALIAS}): Speed'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.15.{#SNMPINDEX}'
              key: 'net.if.speed[ifHighSpeed.{#SNMPINDEX}]'
              delay: 5m
              history: 14d
              trends: '0'
              units: bps
              description: |
                MIB: IF-MIB
                An estimate of the interface's current bandwidth in units of 1,000,000 bits per second. If this object reports a value of `n' then the speed of the interface is somewhere in the range of `n-500,000' to`n+499,999'.  For interfaces which do not vary in bandwidth or for those where no accurate estimation can be made, this object should contain the nominal bandwidth. For a sub-layer which has no concept of bandwidth, this object should be zero.
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '1000000'
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: description
                  value: '{#IFALIAS}'
                -
                  tag: interface
                  value: '{#IFNAME}'
            -
              uuid: 578c7b1628f247b3b82d5d8aad9e78f5
              name: 'Interface {#IFNAME}({#IFALIAS}): Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'net.if.status[ifOperStatus.{#SNMPINDEX}]'
              history: 14d
              trends: '0'
              description: |
                MIB: IF-MIB
                The current operational state of the interface.
                - The testing(3) state indicates that no operational packet scan be passed
                - If ifAdminStatus is down(2) then ifOperStatus should be down(2)
                - If ifAdminStatus is changed to up(1) then ifOperStatus should change to up(1) if the interface is ready to transmit and receive network traffic
                - It should change todormant(5) if the interface is waiting for external actions (such as a serial line waiting for an incoming connection)
                - It should remain in the down(2) state if and only if there is a fault that prevents it from going to the up(1) state
                - It should remain in the notPresent(6) state if the interface has missing(typically, hardware) components.
              valuemap:
                name: 'IF-MIB::ifOperStatus'
              tags:
                -
                  tag: component
                  value: network
                -
                  tag: description
                  value: '{#IFALIAS}'
                -
                  tag: interface
                  value: '{#IFNAME}'
              trigger_prototypes:
                -
                  uuid: 8314e82316d641e08a6cf45f2c37841e
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
                  name: 'Interface {#IFNAME}({#IFALIAS}): Link down'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    Триггер работает следующим образом:
                    1. Стреляет, если "Operation status" интерфейса уходит в состояние "Down(0)".
                    2. Вы можете определять на уровне шаблона или создать на хосте макрос { $IFCONTROL }=1 - для глобального определения всех интерфейсов важными или { $IFCONTROL }=0 - не важными. (Убрать пробелы!)
                    3. Вы можете использовать на хосте макросы с контекстом для определения конкретного интерфейса важным или не важным, в зависимости от Вашего решения в п.2, например:
                    { $IFCONTROL:{#IFNAME} }=1. (Убрать пробелы!)
                    4. Стреляет, если "Operation status" интерфейса до этого был в состоянии "Up(1)"
                    5. Триггер можно закрыть вручную, стрелять при следующем опросе он не будет потому, что п.4.
                  tags:
                    -
                      tag: scope
                      value: availability
          trigger_prototypes:
            -
              uuid: a60a64ad0c4d4c63b8f3069477626c12
              expression: |
                (avg(/Module Eltex MES Interfaces SNMPv2/net.if.in[ifHCInOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Module Eltex MES Interfaces SNMPv2/net.if.speed[ifHighSpeed.{#SNMPINDEX}]) or
                avg(/Module Eltex MES Interfaces SNMPv2/net.if.out[ifHCOutOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Module Eltex MES Interfaces SNMPv2/net.if.speed[ifHighSpeed.{#SNMPINDEX}])) and
                last(/Module Eltex MES Interfaces SNMPv2/net.if.speed[ifHighSpeed.{#SNMPINDEX}])>0
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                avg(/Module Eltex MES Interfaces SNMPv2/net.if.in[ifHCInOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Module Eltex MES Interfaces SNMPv2/net.if.speed[ifHighSpeed.{#SNMPINDEX}]) and
                avg(/Module Eltex MES Interfaces SNMPv2/net.if.out[ifHCOutOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Module Eltex MES Interfaces SNMPv2/net.if.speed[ifHighSpeed.{#SNMPINDEX}])
              name: 'Interface {#IFNAME}({#IFALIAS}): High bandwidth usage ( > {$IF.UTIL.MAX:"{#IFNAME}"}% )'
              opdata: 'In: {ITEM.LASTVALUE1}, out: {ITEM.LASTVALUE3}, speed: {ITEM.LASTVALUE2}'
              priority: INFO
              description: 'The network interface utilization is close to its estimated maximum bandwidth.'
              dependencies:
                -
                  name: 'Interface {#IFNAME}({#IFALIAS}): Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_expression: 'last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
              tags:
                -
                  tag: scope
                  value: performance
            -
              uuid: 679ef43dcdf146f6a48b82f6496790be
              expression: |
                min(/Module Eltex MES Interfaces SNMPv2/net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
                or min(/Module Eltex MES Interfaces SNMPv2/net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                max(/Module Eltex MES Interfaces SNMPv2/net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
                and max(/Module Eltex MES Interfaces SNMPv2/net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
              name: 'Interface {#IFNAME}({#IFALIAS}): High error rate ( > {$IF.ERRORS.WARN:"{#IFNAME}"} for 5m)'
              opdata: 'errors in: {ITEM.LASTVALUE1}, errors out: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'Recovers when below 80% of {$IF.ERRORS.WARN:"{#IFNAME}"} threshold'
              dependencies:
                -
                  name: 'Interface {#IFNAME}({#IFALIAS}): Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_expression: 'last(/Module Eltex MES Interfaces SNMPv2/net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
              tags:
                -
                  tag: scope
                  value: availability
                -
                  tag: scope
                  value: performance
          graph_prototypes:
            -
              uuid: b3ade4155930473ea30f71c0eae743bc
              name: 'Copper Interface {#IFNAME}({#IFALIAS}): Network traffic'
              graph_items:
                -
                  drawtype: GRADIENT_LINE
                  color: 1A7C11
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'net.if.in[ifHCInOctets.{#SNMPINDEX}]'
                -
                  sortorder: '1'
                  drawtype: BOLD_LINE
                  color: 2774A4
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'net.if.out[ifHCOutOctets.{#SNMPINDEX}]'
                -
                  sortorder: '2'
                  color: F63100
                  yaxisside: RIGHT
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
                -
                  sortorder: '3'
                  color: A54F10
                  yaxisside: RIGHT
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
                -
                  sortorder: '4'
                  color: FC6EA3
                  yaxisside: RIGHT
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
                -
                  sortorder: '5'
                  color: 6C59DC
                  yaxisside: RIGHT
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
        -
          uuid: b3e06606ddb14b43a4bf39d224f166a9
          name: 'LAG network interfaces discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFOPERSTATUS},1.3.6.1.2.1.2.2.1.8,{#IFADMINSTATUS},1.3.6.1.2.1.2.2.1.7,{#IFALIAS},1.3.6.1.2.1.31.1.1.1.18,{#IFNAME},1.3.6.1.2.1.31.1.1.1.1,{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: lag.net.if.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#IFADMINSTATUS}'
                value: '{$NET.IF.IFADMINSTATUS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: A
              -
                macro: '{#IFOPERSTATUS}'
                value: '{$NET.IF.IFOPERSTATUS.MATCHES}'
                formulaid: G
              -
                macro: '{#IFALIAS}'
                value: '{$NET.IF.IFALIAS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#IFALIAS}'
                value: '{$NET.IF.IFALIAS.MATCHES}'
                formulaid: D
              -
                macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.MATCHES}'
                formulaid: E
              -
                macro: '{#IFADMINSTATUS}'
                value: '{$NET.IF.IFADMINSTATUS.MATCHES}'
                formulaid: B
              -
                macro: '{#IFOPERSTATUS}'
                value: '{$NET.IF.IFOPERSTATUS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: H
              -
                macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: F
              -
                macro: '{#IFTYPE}'
                value: ^161$
                formulaid: I
          lifetime: 1h
          description: 'Discovering LAG interfaces.'
          item_prototypes:
            -
              uuid: 802a367ee16b41039ea3fe5261754b99
              name: 'Interface {#IFNAME}({#IFALIAS}): Bits received'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.6.{#SNMPINDEX}'
              key: 'lag.net.if.in[ifHCInOctets.{#SNMPINDEX}]'
              history: 14d
              trends: 60d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets received on the interface, including framing characters. This object is a 64-bit version of ifInOctets. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 4c0d2f2b8821422e9664cdc1addc569e
              name: 'Interface {#IFNAME}({#IFALIAS}): Bits sent'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.10.{#SNMPINDEX}'
              key: 'lag.net.if.out[ifHCOutOctets.{#SNMPINDEX}]'
              history: 14d
              trends: 60d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets transmitted out of the interface, including framing characters. This object is a 64-bit version of ifOutOctets.Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 4dba24ac6a304fccb0ae8158b5a27483
              name: 'Interface {#IFNAME}({#IFALIAS}): Speed'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.15.{#SNMPINDEX}'
              key: 'lag.net.if.speed[ifHighSpeed.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: '0'
              units: bps
              description: |
                MIB: IF-MIB
                An estimate of the interface's current bandwidth in units of 1,000,000 bits per second. If this object reports a value of `n' then the speed of the interface is somewhere in the range of `n-500,000' to`n+499,999'.  For interfaces which do not vary in bandwidth or for those where no accurate estimation can be made, this object should contain the nominal bandwidth. For a sub-layer which has no concept of bandwidth, this object should be zero.
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '1000000'
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 162629e60cee4e2cb81041a790264749
              name: 'Interface {#IFNAME}({#IFALIAS}): Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'lag.net.if.status[ifOperStatus.{#SNMPINDEX}]'
              history: 14d
              trends: '0'
              description: |
                MIB: IF-MIB
                The current operational state of the interface.
                - The testing(3) state indicates that no operational packet scan be passed
                - If ifAdminStatus is down(2) then ifOperStatus should be down(2)
                - If ifAdminStatus is changed to up(1) then ifOperStatus should change to up(1) if the interface is ready to transmit and receive network traffic
                - It should change todormant(5) if the interface is waiting for external actions (such as a serial line waiting for an incoming connection)
                - It should remain in the down(2) state if and only if there is a fault that prevents it from going to the up(1) state
                - It should remain in the notPresent(6) state if the interface has missing(typically, hardware) components.
              valuemap:
                name: 'IF-MIB::ifOperStatus'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
              trigger_prototypes:
                -
                  uuid: a6e696bb51d04e26a740acdb6f74bbe8
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
                  name: 'Interface {#IFNAME}({#IFALIAS}): Link down'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    Триггер работает следующим образом:
                    1. Стреляет, если "Operation status" интерфейса уходит в состояние "Down(0)".
                    2. Вы можете определять на уровне шаблона или создать на хосте макрос { $IFCONTROL }=1 - для глобального определения всех интерфейсов важными или { $IFCONTROL }=0 - не важными. (Убрать пробелы!)
                    3. Вы можете использовать на хосте макросы с контекстом для определения конкретного интерфейса важным или не важным, в зависимости от Вашего решения в п.2, например:
                    { $IFCONTROL:{#IFNAME} }=1. (Убрать пробелы!)
                    4. Стреляет, если "Operation status" интерфейса до этого был в состоянии "Up(1)"
                    5. Триггер можно закрыть вручную, стрелять при следующем опросе он не будет потому, что п.4.
          trigger_prototypes:
            -
              uuid: f44537d61cac44b2ba6a57f60a48d73c
              expression: |
                (avg(/Module Eltex MES Interfaces SNMPv2/lag.net.if.in[ifHCInOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.speed[ifHighSpeed.{#SNMPINDEX}]) or
                avg(/Module Eltex MES Interfaces SNMPv2/lag.net.if.out[ifHCOutOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.speed[ifHighSpeed.{#SNMPINDEX}])) and
                last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.speed[ifHighSpeed.{#SNMPINDEX}])>0
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                avg(/Module Eltex MES Interfaces SNMPv2/lag.net.if.in[ifHCInOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.speed[ifHighSpeed.{#SNMPINDEX}]) and
                avg(/Module Eltex MES Interfaces SNMPv2/lag.net.if.out[ifHCOutOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.speed[ifHighSpeed.{#SNMPINDEX}])
              name: 'Interface {#IFNAME}({#IFALIAS}): High bandwidth usage ( > {$IF.UTIL.MAX:"{#IFNAME}"}% )'
              opdata: 'In: {ITEM.LASTVALUE1}, out: {ITEM.LASTVALUE3}, speed: {ITEM.LASTVALUE2}'
              priority: INFO
              description: 'The network interface utilization is close to its estimated maximum bandwidth.'
              dependencies:
                -
                  name: 'Interface {#IFNAME}({#IFALIAS}): Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_expression: 'last(/Module Eltex MES Interfaces SNMPv2/lag.net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
          graph_prototypes:
            -
              uuid: 6b8c6558060841398fa19b511b7c0df6
              name: 'LAG Interface {#IFNAME}({#IFALIAS}): Network traffic'
              graph_items:
                -
                  color: 1A7C11
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'lag.net.if.in[ifHCInOctets.{#SNMPINDEX}]'
                -
                  sortorder: '1'
                  color: 2774A4
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'lag.net.if.out[ifHCOutOctets.{#SNMPINDEX}]'
        -
          uuid: 54d13b3829854fb79179c3830e390c63
          name: 'Optic network interfaces discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFOPERSTATUS},1.3.6.1.2.1.2.2.1.8,{#IFADMINSTATUS},1.3.6.1.2.1.2.2.1.7,{#IFALIAS},1.3.6.1.2.1.31.1.1.1.18,{#IFNAME},1.3.6.1.2.1.31.1.1.1.1,{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#MEDIATYPE},1.3.6.1.4.1.89.53.3.1.3]'
          key: optic.net.if.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#IFOPERSTATUS}'
                value: '{$NET.IF.IFOPERSTATUS.MATCHES}'
                formulaid: G
              -
                macro: '{#MEDIATYPE}'
                value: '^.*$'
                formulaid: I
              -
                macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: E
              -
                macro: '{#MEDIATYPE}'
                value: ^1$
                operator: NOT_MATCHES_REGEX
                formulaid: J
              -
                macro: '{#IFOPERSTATUS}'
                value: '{$NET.IF.IFOPERSTATUS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: H
              -
                macro: '{#IFALIAS}'
                value: '{$NET.IF.IFALIAS.MATCHES}'
                formulaid: C
              -
                macro: '{#IFALIAS}'
                value: '{$NET.IF.IFALIAS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
              -
                macro: '{#IFADMINSTATUS}'
                value: '{$NET.IF.IFADMINSTATUS.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: A
              -
                macro: '{#IFADMINSTATUS}'
                value: '{$NET.IF.IFADMINSTATUS.MATCHES}'
                formulaid: B
              -
                macro: '{#IFNAME}'
                value: '{$NET.IF.IFNAME.MATCHES}'
                formulaid: F
          lifetime: 1h
          description: 'Discovering copper interfaces (optic-fiber(2) or combo(3))'
          item_prototypes:
            -
              uuid: ae032602a04b4d6f91ad4bc86a1a1408
              name: 'Interface {#IFNAME}({#IFALIAS}): Inbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.13.{#SNMPINDEX}'
              key: 'optic.net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: 60d
              description: |
                MIB: IF-MIB
                The number of inbound packets which were chosen to be discarded
                even though no errors had been detected to prevent their being deliverable to a higher-layer protocol.
                One possible reason for discarding such a packet could be to free up buffer space.
                Discontinuities in the value of this counter can occur at re-initialization of the management system,
                and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 453c6a164ee24102915a31d817c37d58
              name: 'Interface {#IFNAME}({#IFALIAS}): Inbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'optic.net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: 60d
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of inbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of inbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 3d4adb772c814d058625748c9f6a68d3
              name: 'Interface {#IFNAME}({#IFALIAS}): Bits received'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.6.{#SNMPINDEX}'
              key: 'optic.net.if.in[ifHCInOctets.{#SNMPINDEX}]'
              history: 14d
              trends: 60d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets received on the interface, including framing characters. This object is a 64-bit version of ifInOctets. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 97d778c98fbd413eaf93d7295c3e6a79
              name: 'Interface {#IFNAME}({#IFALIAS}): Outbound packets discarded'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.19.{#SNMPINDEX}'
              key: 'optic.net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: 60d
              description: |
                MIB: IF-MIB
                An estimate of the interface's current bandwidth in units of 1,000,000 bits per second. If this object reports a value of `n' then the speed of the interface is somewhere in the range of `n-500,000' to`n+499,999'.  For interfaces which do not vary in bandwidth or for those where no accurate estimation can be made, this object should contain the nominal bandwidth. For a sub-layer which has no concept of bandwidth, this object should be zero.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: edfcc3f1cb8a4d47a4859a9ed88acab2
              name: 'Interface {#IFNAME}({#IFALIAS}): Outbound packets with errors'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'optic.net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: 60d
              description: |
                MIB: IF-MIB
                For packet-oriented interfaces, the number of outbound packets that contained errors preventing them from being deliverable to a higher-layer protocol.  For character-oriented or fixed-length interfaces, the number of outbound transmission units that contained errors preventing them from being deliverable to a higher-layer protocol. Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: dcfc1b8ad998411fbd5120f4de97d87b
              name: 'Interface {#IFNAME}({#IFALIAS}): Bits sent'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.10.{#SNMPINDEX}'
              key: 'optic.net.if.out[ifHCOutOctets.{#SNMPINDEX}]'
              history: 14d
              trends: 60d
              units: bps
              description: |
                MIB: IF-MIB
                The total number of octets transmitted out of the interface, including framing characters. This object is a 64-bit version of ifOutOctets.Discontinuities in the value of this counter can occur at re-initialization of the management system, and at other times as indicated by the value of ifCounterDiscontinuityTime.
              preprocessing:
                -
                  type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                -
                  type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 3cdc9cc132d547ac98495cff2a03849a
              name: 'Interface {#IFNAME}({#IFALIAS}): Speed'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.15.{#SNMPINDEX}'
              key: 'optic.net.if.speed[ifHighSpeed.{#SNMPINDEX}]'
              delay: 3m
              history: 14d
              trends: '0'
              units: bps
              description: |
                MIB: IF-MIB
                An estimate of the interface's current bandwidth in units of 1,000,000 bits per second. If this object reports a value of `n' then the speed of the interface is somewhere in the range of `n-500,000' to`n+499,999'.  For interfaces which do not vary in bandwidth or for those where no accurate estimation can be made, this object should contain the nominal bandwidth. For a sub-layer which has no concept of bandwidth, this object should be zero.
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '1000000'
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: dc97986d9e5f4700a5dabfa1807be12c
              name: 'Interface {#IFNAME}({#IFALIAS}): Operational status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'optic.net.if.status[ifOperStatus.{#SNMPINDEX}]'
              history: 14d
              trends: '0'
              description: |
                MIB: IF-MIB
                The current operational state of the interface.
                - The testing(3) state indicates that no operational packet scan be passed
                - If ifAdminStatus is down(2) then ifOperStatus should be down(2)
                - If ifAdminStatus is changed to up(1) then ifOperStatus should change to up(1) if the interface is ready to transmit and receive network traffic
                - It should change todormant(5) if the interface is waiting for external actions (such as a serial line waiting for an incoming connection)
                - It should remain in the down(2) state if and only if there is a fault that prevents it from going to the up(1) state
                - It should remain in the notPresent(6) state if the interface has missing(typically, hardware) components.
              valuemap:
                name: 'IF-MIB::ifOperStatus'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
              trigger_prototypes:
                -
                  uuid: 5663b1f4e78c4153a0617fa0696d6fc6
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
                  name: 'Interface {#IFNAME}({#IFALIAS}): Link down'
                  opdata: 'Current state: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    Триггер работает следующим образом:
                    1. Стреляет, если "Operation status" интерфейса уходит в состояние "Down(0)".
                    2. Вы можете определять на уровне шаблона или создать на хосте макрос { $IFCONTROL }=1 - для глобального определения всех интерфейсов важными или { $IFCONTROL }=0 - не важными. (Убрать пробелы!)
                    3. Вы можете использовать на хосте макросы с контекстом для определения конкретного интерфейса важным или не важным, в зависимости от Вашего решения в п.2, например:
                    { $IFCONTROL:{#IFNAME} }=1. (Убрать пробелы!)
                    4. Стреляет, если "Operation status" интерфейса до этого был в состоянии "Up(1)"
                    5. Триггер можно закрыть вручную, стрелять при следующем опросе он не будет потому, что п.4.
            -
              uuid: 0280c93f92c14c018b4545d73b769366
              name: 'Interface {#IFNAME}({#IFALIAS}): SFP Input power'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.89.90.1.2.1.3.{#SNMPINDEX}.9'
              key: 'optic.rlPhyTestGetResult.InPow[{#SNMPINDEX}]'
              delay: 10m
              history: 1w
              trends: 60d
              value_type: FLOAT
              units: mW/dBm
              description: 'Input power on SFP interface.'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.001'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 03b4d0610d8d4fc6b897b8b7c86533c6
              name: 'Interface {#IFNAME}({#IFALIAS}): SFP mA'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.89.90.1.2.1.3.{#SNMPINDEX}.7'
              key: 'optic.rlPhyTestGetResult.mA[{#SNMPINDEX}]'
              delay: 10m
              history: 1w
              trends: 60d
              value_type: FLOAT
              units: mA
              description: 'mA on SFP interface.'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.001'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 9c22c1dc491d4b04a1c091a3e69c7f0d
              name: 'Interface {#IFNAME}({#IFALIAS}): SFP Out power'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.89.90.1.2.1.3.{#SNMPINDEX}.8'
              key: 'optic.rlPhyTestGetResult.OutPow[{#SNMPINDEX}]'
              delay: 10m
              history: 1w
              trends: 60d
              value_type: FLOAT
              units: mW/dBm
              description: 'Out power on SFP interface.'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.001'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 321d45237c7740c8bc907faca143d7f1
              name: 'Interface {#IFNAME}({#IFALIAS}): SFP temperature'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.89.90.1.2.1.3.{#SNMPINDEX}.5'
              key: 'optic.rlPhyTestGetResult.t[{#SNMPINDEX}]'
              delay: 10m
              history: 1w
              trends: 60d
              value_type: FLOAT
              units: '`C'
              description: 'Temperature on SFP interface.'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
              trigger_prototypes:
                -
                  uuid: 3f028578699543b3970cc586e8a4d0b7
                  expression: 'last(/Module Eltex MES Interfaces SNMPv2/optic.rlPhyTestGetResult.t[{#SNMPINDEX}])>{$SFP.MAX.TEMPERATURE}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/Module Eltex MES Interfaces SNMPv2/optic.rlPhyTestGetResult.t[{#SNMPINDEX}])<{$SFP.MAX.TEMPERATURE}-2'
                  name: 'Interface {#IFNAME}({#IFALIAS}): Температура SFP больше {$SFP.MAX.TEMPERATURE}'
                  opdata: 'SFP t` = {ITEM.LASTVALUE1}'
                  priority: WARNING
            -
              uuid: d772fb5ab6e24ff9a3787ea402013b70
              name: 'Interface {#IFNAME}({#IFALIAS}): SFP Volt'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.89.90.1.2.1.3.{#SNMPINDEX}.6'
              key: 'optic.rlPhyTestGetResult.v[{#SNMPINDEX}]'
              delay: 10m
              history: 1w
              trends: 60d
              value_type: FLOAT
              units: V
              description: 'Volt on SFP interface.'
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.000001'
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
          trigger_prototypes:
            -
              uuid: 25cc04ffca9942a79e9631673bdd8879
              expression: |
                (avg(/Module Eltex MES Interfaces SNMPv2/optic.net.if.in[ifHCInOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.speed[ifHighSpeed.{#SNMPINDEX}]) or
                avg(/Module Eltex MES Interfaces SNMPv2/optic.net.if.out[ifHCOutOctets.{#SNMPINDEX}],15m)>({$IF.UTIL.MAX:"{#IFNAME}"}/100)*last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.speed[ifHighSpeed.{#SNMPINDEX}])) and
                last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.speed[ifHighSpeed.{#SNMPINDEX}])>0
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                avg(/Module Eltex MES Interfaces SNMPv2/optic.net.if.in[ifHCInOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.speed[ifHighSpeed.{#SNMPINDEX}]) and
                avg(/Module Eltex MES Interfaces SNMPv2/optic.net.if.out[ifHCOutOctets.{#SNMPINDEX}],15m)<(({$IF.UTIL.MAX:"{#IFNAME}"}-3)/100)*last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.speed[ifHighSpeed.{#SNMPINDEX}])
              name: 'Interface {#IFNAME}({#IFALIAS}): High bandwidth usage ( > {$IF.UTIL.MAX:"{#IFNAME}"}% )'
              opdata: 'In: {ITEM.LASTVALUE1}, out: {ITEM.LASTVALUE3}, speed: {ITEM.LASTVALUE2}'
              priority: INFO
              description: 'The network interface utilization is close to its estimated maximum bandwidth.'
              dependencies:
                -
                  name: 'Interface {#IFNAME}({#IFALIAS}): Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_expression: 'last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
            -
              uuid: 19c7cb40df294955a5708f45a03045cf
              expression: |
                min(/Module Eltex MES Interfaces SNMPv2/optic.net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
                or min(/Module Eltex MES Interfaces SNMPv2/optic.net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)>{$IF.ERRORS.WARN:"{#IFNAME}"}
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: |
                max(/Module Eltex MES Interfaces SNMPv2/optic.net.if.in.errors[ifInErrors.{#SNMPINDEX}],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
                and max(/Module Eltex MES Interfaces SNMPv2/optic.net.if.out.errors[ifOutErrors.{#SNMPINDEX}],5m)<{$IF.ERRORS.WARN:"{#IFNAME}"}*0.8
              name: 'Interface {#IFNAME}({#IFALIAS}): High error rate ( > {$IF.ERRORS.WARN:"{#IFNAME}"} for 5m)'
              opdata: 'errors in: {ITEM.LASTVALUE1}, errors out: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: 'Recovers when below 80% of {$IF.ERRORS.WARN:"{#IFNAME}"} threshold'
              dependencies:
                -
                  name: 'Interface {#IFNAME}({#IFALIAS}): Link down'
                  expression: '{$IFCONTROL:"{#IFNAME}"}=1 and (last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}])=2 and (last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}],#1)<>last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}],#2))=1)'
                  recovery_expression: 'last(/Module Eltex MES Interfaces SNMPv2/optic.net.if.status[ifOperStatus.{#SNMPINDEX}])<>2'
            -
              uuid: fa578b9d236445c6853cb3d4ed36c108
              expression: 'avg(/Module Eltex MES Interfaces SNMPv2/optic.rlPhyTestGetResult.InPow[{#SNMPINDEX}],5m)<(avg(/Module Eltex MES Interfaces SNMPv2/optic.rlPhyTestGetResult.OutPow[{#SNMPINDEX}],5m)*{$SFP.INOUTPOW.RATIO})'
              name: 'Interface {#IFNAME}({#IFALIAS}): Затухание на SFP'
              opdata: 'InPow: {ITEM.LASTVALUE1}, InPow: {ITEM.LASTVALUE2}'
              priority: WARNING
              description: |
                Потери мощности на оптической линии.
                Для корректировки чувствительности смотри макрос { $SFP.INOUTPOW.RATIO }
          graph_prototypes:
            -
              uuid: 9a2f68acada74e3cb8b3c665b1337750
              name: 'Optic Interface {#IFNAME}({#IFALIAS}): Network traffic'
              graph_items:
                -
                  drawtype: GRADIENT_LINE
                  color: 1A7C11
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'optic.net.if.in[ifHCInOctets.{#SNMPINDEX}]'
                -
                  sortorder: '1'
                  drawtype: BOLD_LINE
                  color: 2774A4
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'optic.net.if.out[ifHCOutOctets.{#SNMPINDEX}]'
                -
                  sortorder: '2'
                  color: F63100
                  yaxisside: RIGHT
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'optic.net.if.out.errors[ifOutErrors.{#SNMPINDEX}]'
                -
                  sortorder: '3'
                  color: A54F10
                  yaxisside: RIGHT
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'optic.net.if.in.errors[ifInErrors.{#SNMPINDEX}]'
                -
                  sortorder: '4'
                  color: FC6EA3
                  yaxisside: RIGHT
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'optic.net.if.out.discards[ifOutDiscards.{#SNMPINDEX}]'
                -
                  sortorder: '5'
                  color: 6C59DC
                  yaxisside: RIGHT
                  item:
                    host: 'Module Eltex MES Interfaces SNMPv2'
                    key: 'optic.net.if.in.discards[ifInDiscards.{#SNMPINDEX}]'
      tags:
        -
          tag: class
          value: network
        -
          tag: target
          value: eltex
        -
          tag: target
          value: eltex-mes
      macros:
        -
          macro: '{$IF.ERRORS.WARN}'
          value: '10'
        -
          macro: '{$IF.UTIL.MAX}'
          value: '90'
        -
          macro: '{$IFCONTROL}'
          value: '1'
        -
          macro: '{$NET.IF.IFADMINSTATUS.MATCHES}'
          value: '^.*'
        -
          macro: '{$NET.IF.IFADMINSTATUS.NOT_MATCHES}'
          value: ^2$
          description: 'Ignore down(2) administrative status'
        -
          macro: '{$NET.IF.IFALIAS.MATCHES}'
          value: '.*'
        -
          macro: '{$NET.IF.IFALIAS.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
        -
          macro: '{$NET.IF.IFDESCR.MATCHES}'
          value: '.*'
        -
          macro: '{$NET.IF.IFDESCR.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
        -
          macro: '{$NET.IF.IFNAME.MATCHES}'
          value: '^.*$'
        -
          macro: '{$NET.IF.IFNAME.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
        -
          macro: '{$NET.IF.IFOPERSTATUS.MATCHES}'
          value: '^.*$'
        -
          macro: '{$NET.IF.IFOPERSTATUS.NOT_MATCHES}'
          value: ^6$
          description: 'Ignore notPresent(6)'
        -
          macro: '{$SFP.INOUTPOW.RATIO}'
          value: '2.5'
          description: 'Во сколько раз различаются InPow и OutPow. Увеличить коэффициент - загрубить триггер.'
        -
          macro: '{$SFP.MAX.TEMPERATURE}'
          value: '60'
          description: 'Макс. температура модуля SFP'
      dashboards:
        -
          uuid: 21a82678814f426685915be841f79419
          name: 'Network interfaces'
          pages:
            -
              widgets:
                -
                  type: GRAPH_PROTOTYPE
                  width: '24'
                  height: '5'
                  fields:
                    -
                      type: INTEGER
                      name: source_type
                      value: '2'
                    -
                      type: INTEGER
                      name: columns
                      value: '1'
                    -
                      type: INTEGER
                      name: rows
                      value: '1'
                    -
                      type: GRAPH_PROTOTYPE
                      name: graphid
                      value:
                        host: 'Module Eltex MES Interfaces SNMPv2'
                        name: 'Copper Interface {#IFNAME}({#IFALIAS}): Network traffic'
      valuemaps:
        -
          uuid: 04a1d65aff9240a08667ebf81e29b440
          name: 'IF-MIB::ifOperStatus'
          mappings:
            -
              value: '1'
              newvalue: up
            -
              value: '2'
              newvalue: down
            -
              value: '4'
              newvalue: unknown
            -
              value: '5'
              newvalue: dormant
            -
              value: '6'
              newvalue: notPresent
            -
              value: '7'
              newvalue: lowerLayerDown
