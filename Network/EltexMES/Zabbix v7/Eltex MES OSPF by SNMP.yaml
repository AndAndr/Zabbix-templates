zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 57b7ae836ca64446ba2c296389c009b7
      name: Templates/Modules
  templates:
    - uuid: 5c632ca859094cfd939235b7c5410050
      template: 'Eltex MES OSPF by SNMP export'
      name: 'Eltex MES OSPF by SNMP export'
      description: |
        https://github.com/AndAndr
        Автообнаружение соседей OSPF для коммутаторов Eltex серии MES.
      groups:
        - name: Templates/Modules
      discovery_rules:
        - uuid: fb04b3b4793240a0afe35a47a409f745
          name: 'Eltex OSPF nbr discover'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},.1.3.6.1.4.1.89.210.11.1.2.1]'
          key: rlOspfNbrIpAddr
          delay: 1h
          item_prototypes:
            - uuid: 374af00928034141b353a14b7c0be34c
              name: 'Eltex OSPF neighbor {#SNMPVALUE} state'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.89.210.11.1.7.1.{#SNMPVALUE}.0'
              key: 'rlOspfNbrState[{#SNMPVALUE}]'
              history: 14d
              trends: '0'
              description: 'Full (8) - норма. Когда TwoWay (4) тоже норма, то триггер можно закрыть руками.'
              valuemap:
                name: 'SNMP OSPF Neighbor State (ospfNbrState)'
              tags:
                - tag: application
                  value: ospf
              trigger_prototypes:
                - uuid: 0f7db94a07b241f5bdc7e97dc9e41978
                  expression: 'last(/Eltex MES OSPF by SNMP export/rlOspfNbrState[{#SNMPVALUE}])<>8 and (last(/Eltex MES OSPF by SNMP export/rlOspfNbrState[{#SNMPVALUE}],#1)<>last(/Eltex MES OSPF by SNMP export/rlOspfNbrState[{#SNMPVALUE}],#2))=1'
                  name: 'OSPF: Check neighbor {#SNMPVALUE} state'
                  opdata: 'NBR State={ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: |
                    Доступно ручное закрытие, если TwoWay (4) - это норма.
                    Триггер повторно не стреляет.
                  tags:
                    - tag: application
                      value: ospf
                    - tag: neighbor
                      value: '{#SNMPVALUE}'
      tags:
        - tag: application
          value: ospf
        - tag: class
          value: network
        - tag: target
          value: eltex
        - tag: target
          value: eltex-mes
      valuemaps:
        - uuid: 873ccf9f85d14d8e817f177e04d61a37
          name: 'SNMP OSPF Neighbor State (ospfNbrState)'
          mappings:
            - value: '1'
              newvalue: Down
            - value: '2'
              newvalue: Attempt
            - value: '3'
              newvalue: Init
            - value: '4'
              newvalue: TwoWay
            - value: '5'
              newvalue: ExchangeStart
            - value: '6'
              newvalue: Exchange
            - value: '7'
              newvalue: Loading
            - value: '8'
              newvalue: Full
